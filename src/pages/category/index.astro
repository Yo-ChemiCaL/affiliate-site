---
import BaseLayout from '../../layouts/BaseLayout.astro';
import type { Product } from '../../components/ProductCard.astro';
import { url } from '../../lib/url';
import productsData from '../../data/products.json';

const products = productsData as Product[];

// カテゴリごとに商品をまとめる
const categoryMap = products.reduce<Record<string, Product[]>>((acc, p) => {
  if (!acc[p.category]) acc[p.category] = [];
  acc[p.category].push(p);
  return acc;
}, {});

const categories = Object.entries(categoryMap).sort((a, b) => b[1].length - a[1].length);
---

<BaseLayout
  title="カテゴリ一覧 | mono-lab"
  description="ガジェット・家電・スマートホームなど全カテゴリのおすすめ商品一覧。"
>
  <div class="container page-content">
    <h1 class="page-title">カテゴリ一覧</h1>
    <p class="page-desc">気になるカテゴリから商品を探してみてください。</p>

    <div class="category-grid">
      {categories.map(([name, items]) => {
        const top = items[0];
        return (
          <a href={url(`/category/${encodeURIComponent(name)}/`)} class="category-card">
            <div class="category-thumb">
              <img src={top.image} alt={name} loading="lazy" width="300" height="200" />
            </div>
            <div class="category-info">
              <span class="category-name">{name}</span>
              <span class="category-count">{items.length}件</span>
            </div>
          </a>
        );
      })}
    </div>
  </div>
</BaseLayout>

<style>
  .page-content {
    padding-top: 40px;
    padding-bottom: 64px;
  }

  .page-title {
    font-size: 1.8rem;
    font-weight: 900;
    margin-bottom: 8px;
  }

  .page-desc {
    color: var(--color-text-muted);
    font-size: 0.95rem;
    margin-bottom: 32px;
  }

  .category-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 20px;
  }

  .category-card {
    background: var(--color-card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    transition: transform var(--transition), box-shadow var(--transition);
    color: var(--color-text);
  }

  .category-card:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-hover);
  }

  .category-thumb {
    aspect-ratio: 3 / 2;
    overflow: hidden;
    background: #f0f0f0;
  }

  .category-thumb img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .category-card:hover .category-thumb img {
    transform: scale(1.05);
  }

  .category-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
  }

  .category-name {
    font-weight: 700;
    font-size: 0.95rem;
  }

  .category-count {
    font-size: 0.78rem;
    color: var(--color-text-muted);
    background: var(--color-bg);
    padding: 2px 8px;
    border-radius: 12px;
  }
</style>
