---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProductCard from '../components/ProductCard.astro';
import type { Product } from '../components/ProductCard.astro';
import { url } from '../lib/url';
import { toCategorySlug } from '../lib/category';
import productsData from '../data/products.json';

const products = productsData as Product[];

// â”€â”€ CVé€Ÿåº¦Tierå®šç¾© (æ³¨ç›®å•†å“ã‚½ãƒ¼ãƒˆç”¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// S: charging, A: work-setup/commute, B: consumables, C: ãã®ä»–
const CV_TIER: Record<string, number> = {
  'charging': 0,
  'work-setup': 1,
  'commute': 1,
  'consumables': 2,
};
const getCvTier = (p: Product): number =>
  CV_TIER[(p as any).categorySlug ?? toCategorySlug(p.category)] ?? 3;

// â”€â”€ Quick Picks: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—åˆ¥3é¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const USER_TYPE_PICKS: Array<{ typeLabel: string; slug: string }> = [
  { typeLabel: 'ğŸ  åœ¨å®…ãƒ¡ã‚¤ãƒ³',  slug: 'logicool-mx-master-3s' },
  { typeLabel: 'ğŸšƒ æ¯æ—¥é€šå‹¤',    slug: 'anker-soundcore-life-p3' },
  { typeLabel: 'âœˆï¸ å‡ºå¼µãƒ»æ—…è¡Œ',  slug: 'anker-733-powerbank-10k' },
];
const quickPicks = USER_TYPE_PICKS.map(({ typeLabel, slug }) => ({
  ...(products.find((p) => p.slug === slug) as Product),
  typeLabel,
}));

// â”€â”€ æ³¨ç›®å•†å“ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const featuredProducts = products
  .filter((p) => p.featured)
  .sort((a, b) => {
    const tierDiff = getCvTier(a) - getCvTier(b);
    return tierDiff !== 0 ? tierDiff : b.rating - a.rating;
  });

// â”€â”€ ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ï¼ˆè‹±èªslugï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const categoryMap = products.reduce<Record<string, { name: string; slug: string; count: number }>>((acc, p) => {
  const slug = (p as any).categorySlug ?? toCategorySlug(p.category);
  if (!acc[slug]) acc[slug] = { name: p.category, slug, count: 0 };
  acc[slug].count++;
  return acc;
}, {});
const categories = Object.values(categoryMap);

// â”€â”€ æœ€æ–°ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆæ¯”è¼ƒè¨˜äº‹ï¼‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const bestFiles = await Astro.glob('../data/best/*.json');
const bestArticles = bestFiles.map((f) => f.default).slice(0, 3);
---

<BaseLayout
  title="mono-lab | ç”¨é€”åˆ¥ãƒ»æ¯”è¼ƒã§é¸ã¶è³¼å…¥ã‚¬ã‚¤ãƒ‰"
  description="ãƒ†ãƒ¬ãƒ¯ãƒ¼ã‚¯ãƒ»é€šå‹¤ãƒ»å……é›»ãªã©ç”¨é€”åˆ¥ã«å•†å“ã‚’æ¯”è¼ƒã€‚è³¼å…¥ç›´å‰ã®è¿·ã„ã‚’ã‚¼ãƒ­ã«ã™ã‚‹å•†å“é¸ã³ã‚¬ã‚¤ãƒ‰ã€‚"
>
  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <h1 class="hero-title">ç”¨é€”ã‹ã‚‰é¸ã¶ã€‚æ¯”è¼ƒã—ã¦ã€ã™ãè²·ã†ã€‚</h1>
      <p class="hero-subtitle">è³¼å…¥ç›´å‰ã®è¿·ã„ã‚’ã‚¼ãƒ­ã«ã™ã‚‹å•†å“é¸ã³ã‚¬ã‚¤ãƒ‰</p>
      <div class="hero-actions">
        <a href={url('/ranking/')} class="btn-hero-primary">æ¯”è¼ƒã‹ã‚‰æ¢ã™ â†’</a>
        <a href="#quick-picks" class="btn-hero-secondary">ä»Šã™ãé¸ã¶ â†’</a>
      </div>
    </div>
  </section>

  <!-- Quick Picks -->
  <section class="section section-light" id="quick-picks">
    <div class="container">
      <div class="section-head">
        <h2 class="section-title">åœ¨å®… / é€šå‹¤ / æ—…è¡Œ â€” ç”¨é€”åˆ¥ãŠã™ã™ã‚1é¸</h2>
      </div>
      <div class="qp-grid">
        {quickPicks.map((p) => {
          const discount = p.originalPrice && p.price
            ? Math.round((1 - p.price / p.originalPrice) * 100)
            : null;
          return (
            <div class="qp-card">
              <div class="qp-image">
                <img src={p.image} alt={p.title} loading="eager" width="300" height="200" />
                {discount && <span class="qp-off">{discount}%OFF</span>}
              </div>
              <div class="qp-body">
                <span class="qp-scene">{(p as any).typeLabel}</span>
                <p class="qp-title">{p.title}</p>
                <ul class="qp-points">
                  <li class="qp-strength">âœ… {(p as any).strength}</li>
                  <li class="qp-caution">âš ï¸ {(p as any).caution}</li>
                </ul>
                {p.price && <p class="qp-price">Â¥{p.price.toLocaleString()}</p>}
                <a href={url(`/pick/${(p as any).pickSlug}/`)} class="btn-qp-pick">
                  ä»Šã™ãé¸ã¶ â†’
                </a>
              </div>
            </div>
          );
        })}
      </div>
    </div>
  </section>

  <!-- æ¯”è¼ƒå…¥å£ãƒãƒŠãƒ¼ -->
  <div class="compare-entry-banner">
    <div class="container">
      <div class="compare-entry-inner">
        <p class="compare-entry-text">ã‚‚ã£ã¨æ¯”ã¹ã¦ã‹ã‚‰é¸ã³ãŸã„æ–¹ã¯</p>
        <a href={url('/ranking/')} class="btn-compare-entry">æ¯”è¼ƒã‹ã‚‰æ¢ã™ â†’</a>
      </div>
    </div>
  </div>

  <!-- ç”¨é€”åˆ¥ã‚«ãƒ†ã‚´ãƒª -->
  <section class="section">
    <div class="container">
      <div class="section-head">
        <h2 class="section-title">ç”¨é€”åˆ¥ã§æ¢ã™</h2>
        <a href={url('/category/')} class="see-all">ä¸€è¦§ã‚’è¦‹ã‚‹ â†’</a>
      </div>
      <div class="category-list">
        {categories.map((cat) => (
          <a href={url(`/category/${cat.slug}/`)} class="category-badge">
            {cat.name} ({cat.count})
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- æ³¨ç›®å•†å“ -->
  {featuredProducts.length > 0 && (
    <section class="section section-light">
      <div class="container">
        <div class="section-head">
          <h2 class="section-title">â˜… æ³¨ç›®å•†å“</h2>
        </div>
        <div class="product-grid">
          {featuredProducts.map((product) => <ProductCard product={product} />)}
        </div>
      </div>
    </section>
  )}

  <!-- æœ€æ–°ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
  <section class="section">
    <div class="container">
      <div class="section-head">
        <h2 class="section-title">æœ€æ–°ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
        <a href={url('/best/')} class="see-all">ã™ã¹ã¦è¦‹ã‚‹ â†’</a>
      </div>
      <div class="review-list">
        {bestArticles.map((article) => (
          <a href={url(`/best/${article.slug}/`)} class="review-card">
            <div class="review-card-body">
              <span class="review-category">{article.category}</span>
              <h3 class="review-title">{article.title}</h3>
              <p class="review-desc">{article.description}</p>
            </div>
            <span class="review-link-btn">æ¯”è¼ƒã‚’è¦‹ã‚‹ â†’</span>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆè¡¨è¨˜ -->
  <div class="container">
    <p class="disclosure">
      â€» å½“ã‚µã‚¤ãƒˆã¯Amazonã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‚åŠ ã—ã¦ã„ã¾ã™ã€‚å•†å“ãƒªãƒ³ã‚¯ã‹ã‚‰è³¼å…¥ã„ãŸã ã„ãŸå ´åˆã€ã‚µã‚¤ãƒˆé‹å–¶è€…ãŒå ±é…¬ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
    </p>
  </div>
</BaseLayout>

<style>
  /* â”€â”€ Hero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .hero {
    background: linear-gradient(135deg, var(--color-secondary) 0%, #2d2d5e 100%);
    color: #fff;
    padding: 64px 0 56px;
    text-align: center;
  }
  .hero-title {
    font-size: clamp(1.5rem, 4vw, 2.4rem);
    font-weight: 900;
    line-height: 1.3;
    margin-bottom: 12px;
  }
  .hero-subtitle {
    color: rgba(255,255,255,0.75);
    margin-bottom: 32px;
    font-size: 1rem;
  }
  .hero-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .btn-hero-primary {
    display: inline-block;
    padding: 14px 28px;
    background: var(--color-primary);
    color: #fff;
    border-radius: var(--radius);
    font-weight: 700;
    font-size: 1rem;
    transition: all var(--transition);
  }
  .btn-hero-primary:hover { background: var(--color-primary-dark); transform: translateY(-1px); }
  .btn-hero-secondary {
    display: inline-block;
    padding: 14px 28px;
    border: 2px solid rgba(255,255,255,0.6);
    color: #fff;
    border-radius: var(--radius);
    font-weight: 700;
    font-size: 1rem;
    transition: all var(--transition);
  }
  .btn-hero-secondary:hover { border-color: #fff; background: rgba(255,255,255,0.1); }

  /* â”€â”€ Section å…±é€š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .section { padding: 48px 0; }
  .section-light { background: #fff; }
  .section-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
  }
  .section-title { font-size: 1.3rem; font-weight: 800; }
  .see-all { font-size: 0.85rem; font-weight: 700; color: var(--color-primary); }

  /* â”€â”€ Quick Picks â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .qp-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
    gap: 20px;
  }
  .qp-card {
    background: var(--color-card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    border: 2px solid transparent;
    transition: border-color var(--transition), box-shadow var(--transition);
  }
  .qp-card:hover {
    border-color: var(--color-primary);
    box-shadow: var(--shadow-hover);
  }
  .qp-image {
    position: relative;
    aspect-ratio: 3/2;
    overflow: hidden;
    background: #f5f5f5;
  }
  .qp-image img {
    width: 100%;
    height: 100%;
    object-fit: contain;
    padding: 8px;
  }
  .qp-off {
    position: absolute;
    top: 8px;
    right: 8px;
    background: #e63946;
    color: #fff;
    font-size: 0.7rem;
    font-weight: 700;
    padding: 2px 7px;
    border-radius: 4px;
  }
  .qp-body {
    padding: 14px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex: 1;
  }
  .qp-scene {
    display: inline-block;
    font-size: 0.72rem;
    font-weight: 700;
    color: var(--color-primary);
    background: #fff4ef;
    padding: 3px 8px;
    border-radius: 3px;
    align-self: flex-start;
  }
  .qp-title {
    font-size: 0.88rem;
    font-weight: 800;
    line-height: 1.4;
  }
  .qp-points {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .qp-points li { font-size: 0.8rem; line-height: 1.5; }
  .qp-caution { color: var(--color-text-muted); }
  .qp-price {
    font-size: 1.2rem;
    font-weight: 900;
    color: #e63946;
  }
  .btn-qp-cta {
    display: block;
    text-align: center;
    padding: 10px;
    font-size: 0.88rem;
    margin-top: auto;
  }
  .btn-qp-pick {
    display: block;
    text-align: center;
    padding: 11px 10px;
    font-size: 0.88rem;
    font-weight: 700;
    background: var(--color-primary);
    color: #fff;
    border-radius: var(--radius);
    margin-top: auto;
    transition: all var(--transition);
  }
  .btn-qp-pick:hover { background: var(--color-primary-dark); transform: translateY(-1px); color: #fff; }

  /* â”€â”€ æ¯”è¼ƒå…¥å£ãƒãƒŠãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .compare-entry-banner {
    background: #fff4ef;
    padding: 18px 0;
    border-top: 1px solid #fbd5c0;
    border-bottom: 1px solid #fbd5c0;
  }
  .compare-entry-inner {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
    flex-wrap: wrap;
  }
  .compare-entry-text {
    font-size: 0.95rem;
    font-weight: 600;
    color: var(--color-text);
  }
  .btn-compare-entry {
    display: inline-block;
    padding: 10px 24px;
    background: var(--color-primary);
    color: #fff;
    border-radius: var(--radius);
    font-weight: 700;
    font-size: 0.9rem;
    transition: all var(--transition);
  }
  .btn-compare-entry:hover { background: var(--color-primary-dark); transform: translateY(-1px); }

  /* â”€â”€ ç”¨é€”åˆ¥ã‚«ãƒ†ã‚´ãƒª â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .category-list { display: flex; flex-wrap: wrap; gap: 10px; }
  .category-badge {
    display: inline-block;
    padding: 8px 16px;
    background-color: var(--color-bg);
    border: 2px solid var(--color-border);
    border-radius: 24px;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--color-text);
    transition: all var(--transition);
  }
  .category-badge:hover {
    border-color: var(--color-primary);
    background-color: var(--color-primary);
    color: #fff;
  }

  /* â”€â”€ æœ€æ–°ãƒ¬ãƒ“ãƒ¥ãƒ¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .review-list { display: flex; flex-direction: column; gap: 12px; }
  .review-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
    background: var(--color-card);
    border-radius: var(--radius);
    padding: 20px 24px;
    box-shadow: var(--shadow);
    color: var(--color-text);
    transition: box-shadow var(--transition), transform var(--transition);
  }
  .review-card:hover { box-shadow: var(--shadow-hover); transform: translateY(-1px); }
  .review-category {
    font-size: 0.7rem;
    color: var(--color-primary);
    font-weight: 700;
    text-transform: uppercase;
    display: block;
    margin-bottom: 4px;
  }
  .review-title { font-size: 0.95rem; font-weight: 800; margin-bottom: 4px; line-height: 1.4; }
  .review-desc { font-size: 0.8rem; color: var(--color-text-muted); line-height: 1.5; }
  .review-link-btn {
    white-space: nowrap;
    font-size: 0.82rem;
    font-weight: 700;
    color: var(--color-primary);
    padding: 8px 14px;
    border: 2px solid var(--color-primary);
    border-radius: var(--radius);
    transition: all var(--transition);
  }
  .review-card:hover .review-link-btn { background: var(--color-primary); color: #fff; }

  /* â”€â”€ ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆè¡¨è¨˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  .disclosure {
    font-size: 0.75rem;
    color: var(--color-text-muted);
    padding: 16px 0 32px;
    line-height: 1.6;
  }

  @media (max-width: 600px) {
    .review-card { flex-direction: column; align-items: flex-start; }
  }
</style>
