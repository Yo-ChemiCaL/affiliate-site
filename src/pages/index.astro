---
import BaseLayout from '../layouts/BaseLayout.astro';
import ProductCard from '../components/ProductCard.astro';
import type { Product } from '../components/ProductCard.astro';
import { url } from '../lib/url';
import { toCategorySlug } from '../lib/category';
import productsData from '../data/products.json';

const products = productsData as Product[];
const featuredProducts = products.filter((p) => p.featured);

// Quick Picks: pickSlugãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹å•†å“ã‹ã‚‰æœ€å¤§3ã¤
const quickPickProducts = products
  .filter((p) => (p as any).pickSlug)
  .slice(0, 3);

// Bestè¨˜äº‹
const bestFiles = await Astro.glob('../data/best/*.json');
const bestArticles = bestFiles.map((f) => f.default).slice(0, 3);

// ã‚«ãƒ†ã‚´ãƒªä¸€è¦§ï¼ˆè‹±èªslugï¼‰
const categoryMap = products.reduce<Record<string, { name: string; slug: string; count: number }>>((acc, p) => {
  const slug = (p as any).categorySlug ?? toCategorySlug(p.category);
  if (!acc[slug]) acc[slug] = { name: p.category, slug, count: 0 };
  acc[slug].count++;
  return acc;
}, {});
const categories = Object.values(categoryMap);
---

<BaseLayout
  title="mono-lab | ãŠã™ã™ã‚å•†å“ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»æ¯”è¼ƒ"
  description="AmazonãŠã™ã™ã‚å•†å“ã®æ¯”è¼ƒãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ»å³æ±ºã‚¬ã‚¤ãƒ‰ã€‚ã‚¬ã‚¸ã‚§ãƒƒãƒˆãƒ»å®¶é›»ãƒ»ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ã‚’å³é¸ç´¹ä»‹ã€‚"
>
  <!-- Hero -->
  <section class="hero">
    <div class="container">
      <h1 class="hero-title">è²·ã£ã¦å¾Œæ‚”ã—ãªã„é¸ã³æ–¹ã‚’<br />ä¸€ç·’ã«è€ƒãˆã¾ã™</h1>
      <p class="hero-subtitle">æ¯”è¼ƒè¨˜äº‹ãƒ»å³æ±ºã‚¬ã‚¤ãƒ‰ã§è¿·ã‚ãšæœ€é©ãª1å°ã¸</p>
      <div class="hero-actions">
        <a href={url('/best/')} class="btn-hero-primary">ğŸ“Š æ¯”è¼ƒè¨˜äº‹ã‚’è¦‹ã‚‹</a>
        <a href={url('/pick/')} class="btn-hero-secondary">âš¡ å³æ±ºã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹</a>
      </div>
    </div>
  </section>

  <!-- Quick Picksï¼ˆãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆãƒ“ãƒ¥ãƒ¼ç›´ä¸‹ï¼‰ -->
  <section class="section section-light">
    <div class="container">
      <div class="section-head">
        <h2 class="section-title">âš¡ Quick Picks â€” ä»Šã™ãæ±ºã‚ãŸã„æ–¹ã¸</h2>
        <a href={url('/pick/')} class="see-all">ã™ã¹ã¦è¦‹ã‚‹ â†’</a>
      </div>
      <div class="quick-picks-grid">
        {quickPickProducts.map((product) => {
          const p = product as any;
          const discount = p.originalPrice && p.price
            ? Math.round((1 - p.price / p.originalPrice) * 100)
            : null;
          return (
            <a href={url(`/pick/${p.pickSlug}/`)} class="quick-pick-card">
              <div class="qp-image">
                <img src={p.image} alt={p.title} loading="lazy" width="200" height="140" />
                {discount && <span class="qp-discount">{discount}%OFF</span>}
              </div>
              <div class="qp-body">
                <p class="qp-category">{p.category}</p>
                <p class="qp-title">{p.title}</p>
                {p.price && <p class="qp-price">Â¥{p.price.toLocaleString()}</p>}
                <span class="qp-cta">å³æ±ºã‚¬ã‚¤ãƒ‰ã‚’è¦‹ã‚‹ â†’</span>
              </div>
            </a>
          );
        })}
      </div>
    </div>
  </section>

  <!-- Best æ¯”è¼ƒè¨˜äº‹ -->
  <section class="section">
    <div class="container">
      <div class="section-head">
        <h2 class="section-title">ğŸ“Š æ¯”è¼ƒãƒ»ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¨˜äº‹</h2>
        <a href={url('/best/')} class="see-all">ã™ã¹ã¦è¦‹ã‚‹ â†’</a>
      </div>
      <div class="best-list">
        {bestArticles.map((article) => (
          <a href={url(`/best/${article.slug}/`)} class="best-card">
            <div class="best-card-body">
              <span class="best-category">{article.category}</span>
              <h3 class="best-title">{article.title}</h3>
              <p class="best-desc">{article.description}</p>
            </div>
            <span class="best-link-btn">æ¯”è¼ƒã‚’è¦‹ã‚‹ â†’</span>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- æ³¨ç›®å•†å“ -->
  {featuredProducts.length > 0 && (
    <section class="section section-light">
      <div class="container">
        <div class="section-head">
          <h2 class="section-title">â˜… æ³¨ç›®å•†å“</h2>
        </div>
        <div class="product-grid">
          {featuredProducts.map((product) => <ProductCard product={product} />)}
        </div>
      </div>
    </section>
  )}

  <!-- ã‚«ãƒ†ã‚´ãƒª -->
  <section class="section">
    <div class="container">
      <div class="section-head">
        <h2 class="section-title">ã‚«ãƒ†ã‚´ãƒªã‹ã‚‰æ¢ã™</h2>
        <a href={url('/category/')} class="see-all">ä¸€è¦§ã‚’è¦‹ã‚‹ â†’</a>
      </div>
      <div class="category-list">
        {categories.map((cat) => (
          <a href={url(`/category/${cat.slug}/`)} class="category-badge">
            {cat.name} ({cat.count})
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆè¡¨è¨˜ -->
  <div class="container">
    <p class="disclosure">
      â€» å½“ã‚µã‚¤ãƒˆã¯Amazonã‚¢ã‚½ã‚·ã‚¨ã‚¤ãƒˆãƒ»ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«å‚åŠ ã—ã¦ã„ã¾ã™ã€‚å•†å“ãƒªãƒ³ã‚¯ã‹ã‚‰è³¼å…¥ã„ãŸã ã„ãŸå ´åˆã€ã‚µã‚¤ãƒˆé‹å–¶è€…ãŒå ±é…¬ã‚’å—ã‘å–ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚
    </p>
  </div>
</BaseLayout>

<style>
  /* Hero */
  .hero { background: linear-gradient(135deg, var(--color-secondary) 0%, #2d2d5e 100%); color: #fff; padding: 64px 0 56px; text-align: center; }
  .hero-title { font-size: clamp(1.5rem, 4vw, 2.4rem); font-weight: 900; line-height: 1.3; margin-bottom: 12px; }
  .hero-subtitle { color: rgba(255,255,255,0.75); margin-bottom: 32px; font-size: 1rem; }
  .hero-actions { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
  .btn-hero-primary { display: inline-block; padding: 14px 28px; background: var(--color-primary); color: #fff; border-radius: var(--radius); font-weight: 700; font-size: 1rem; transition: all var(--transition); }
  .btn-hero-primary:hover { background: var(--color-primary-dark); transform: translateY(-1px); }
  .btn-hero-secondary { display: inline-block; padding: 14px 28px; border: 2px solid rgba(255,255,255,0.6); color: #fff; border-radius: var(--radius); font-weight: 700; font-size: 1rem; transition: all var(--transition); }
  .btn-hero-secondary:hover { border-color: #fff; background: rgba(255,255,255,0.1); }

  /* Section */
  .section { padding: 48px 0; }
  .section-light { background: #fff; }
  .section-head { display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px; }
  .section-title { font-size: 1.3rem; font-weight: 800; }
  .see-all { font-size: 0.85rem; font-weight: 700; color: var(--color-primary); }

  /* Quick Picks */
  .quick-picks-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px; }
  .quick-pick-card { background: var(--color-card); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; color: var(--color-text); transition: transform var(--transition), box-shadow var(--transition); border: 2px solid transparent; }
  .quick-pick-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-hover); border-color: var(--color-primary); }
  .qp-image { position: relative; aspect-ratio: 3/2; overflow: hidden; }
  .qp-image img { width: 100%; height: 100%; object-fit: cover; }
  .qp-discount { position: absolute; top: 8px; right: 8px; background: #e63946; color: #fff; font-size: 0.7rem; font-weight: 700; padding: 2px 7px; border-radius: 4px; }
  .qp-body { padding: 12px; }
  .qp-category { font-size: 0.68rem; color: var(--color-primary); font-weight: 700; text-transform: uppercase; margin-bottom: 4px; }
  .qp-title { font-size: 0.85rem; font-weight: 700; line-height: 1.4; margin-bottom: 6px; }
  .qp-price { font-size: 1rem; font-weight: 900; color: #e63946; margin-bottom: 8px; }
  .qp-cta { font-size: 0.78rem; font-weight: 700; color: var(--color-primary); border-bottom: 1px solid currentColor; }

  /* Best Cards */
  .best-list { display: flex; flex-direction: column; gap: 12px; }
  .best-card { display: flex; justify-content: space-between; align-items: center; gap: 16px; background: var(--color-card); border-radius: var(--radius); padding: 20px 24px; box-shadow: var(--shadow); color: var(--color-text); transition: box-shadow var(--transition), transform var(--transition); }
  .best-card:hover { box-shadow: var(--shadow-hover); transform: translateY(-1px); }
  .best-category { font-size: 0.7rem; color: var(--color-primary); font-weight: 700; text-transform: uppercase; display: block; margin-bottom: 4px; }
  .best-title { font-size: 0.95rem; font-weight: 800; margin-bottom: 4px; line-height: 1.4; }
  .best-desc { font-size: 0.8rem; color: var(--color-text-muted); line-height: 1.5; }
  .best-link-btn { white-space: nowrap; font-size: 0.82rem; font-weight: 700; color: var(--color-primary); padding: 8px 14px; border: 2px solid var(--color-primary); border-radius: var(--radius); transition: all var(--transition); }
  .best-card:hover .best-link-btn { background: var(--color-primary); color: #fff; }

  /* Category */
  .category-list { display: flex; flex-wrap: wrap; gap: 10px; }
  .category-badge { display: inline-block; padding: 8px 16px; background-color: var(--color-bg); border: 2px solid var(--color-border); border-radius: 24px; font-size: 0.85rem; font-weight: 600; color: var(--color-text); transition: all var(--transition); }
  .category-badge:hover { border-color: var(--color-primary); background-color: var(--color-primary); color: #fff; }

  .disclosure { font-size: 0.75rem; color: var(--color-text-muted); padding: 16px 0 32px; line-height: 1.6; }

  @media (max-width: 600px) {
    .best-card { flex-direction: column; align-items: flex-start; }
  }
</style>
