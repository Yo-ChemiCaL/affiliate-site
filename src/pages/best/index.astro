---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { url } from '../../lib/url';

const bestFiles = await Astro.glob('../../data/best/*.json');
const articles = bestFiles
  .map((f) => f.default)
  .filter((a) => !a.draft)
  .sort((a, b) => new Date(b.publishedAt).getTime() - new Date(a.publishedAt).getTime());

// カテゴリ別にグループ化（出現順を保持）
const categoryMap: Record<string, { name: string; articles: typeof articles }> = {};
for (const article of articles) {
  const cat = article.category ?? '未分類';
  if (!categoryMap[cat]) categoryMap[cat] = { name: cat, articles: [] };
  categoryMap[cat].articles.push(article);
}

// CV速度Tier順にカテゴリを並び替え
const CATEGORY_CV_ORDER = [
  'ケーブル・充電',
  'キーボード・マウス',
  'モニター・ディスプレイ',
  'ハブ・拡張',
  'オーディオ・集中',
  'ライト・照明',
  'スタンド・周辺機器',
];
const categories = Object.values(categoryMap).sort((a, b) => {
  const ia = CATEGORY_CV_ORDER.indexOf(a.name);
  const ib = CATEGORY_CV_ORDER.indexOf(b.name);
  return (ia === -1 ? 99 : ia) - (ib === -1 ? 99 : ib);
});

// アンカー用スラッグ生成
function catSlug(name: string) {
  return name
    .replace(/[・]/g, '-')
    .replace(/[^\w\u3040-\u9fff\uFF00-\uFFEF-]/g, '')
    .toLowerCase();
}
---

<BaseLayout
  title="デスクセットアップ 比較記事一覧 | mono-lab"
  description="モニター・キーボード・照明・ハブ・オーディオなど、デスク環境構築に役立つカテゴリ別おすすめ比較記事の一覧です。"
>
  <div class="container page-content">
    <h1 class="page-title">デスクセットアップ 比較記事</h1>
    <p class="page-desc">モニター・入力デバイス・照明・ハブなど、デスク環境構築に役立つ比較記事をカテゴリ別にまとめました。</p>

    <!-- カテゴリジャンプナビ -->
    <nav class="cat-nav" aria-label="カテゴリ一覧">
      {categories.map(({ name }) => (
        <a href={`#${catSlug(name)}`} class="cat-nav-link">
          {name}
          <span class="cat-count">{categoryMap[name].articles.length}</span>
        </a>
      ))}
    </nav>

    <!-- カテゴリ別セクション -->
    {categories.map(({ name, articles: items }) => (
      <section class="category-section" id={catSlug(name)}>
        <div class="category-section-head">
          <h2 class="category-section-title">{name}</h2>
          <span class="article-count">{items.length}件</span>
        </div>

        <div class="article-list">
          {items.map((article) => (
            <a href={url(`/best/${article.slug}/`)} class="article-card">
              <div class="article-body">
                <h3 class="article-title">{article.title}</h3>
                <p class="article-desc">{article.description}</p>
              </div>
              <span class="article-cta">比較を見る →</span>
            </a>
          ))}
        </div>
      </section>
    ))}
  </div>
</BaseLayout>

<style>
  .page-content { padding: 40px 0 64px; }
  .page-title { font-size: 1.8rem; font-weight: 900; margin-bottom: 8px; }
  .page-desc { color: var(--color-text-muted); font-size: 0.95rem; margin-bottom: 28px; }

  /* カテゴリジャンプナビ */
  .cat-nav {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 48px;
    padding: 16px 20px;
    background: var(--color-card);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
  }

  .cat-nav-link {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    background: var(--color-bg);
    border: 2px solid var(--color-border);
    border-radius: 20px;
    font-size: 0.82rem;
    font-weight: 700;
    color: var(--color-text);
    transition: all var(--transition);
  }

  .cat-nav-link:hover {
    border-color: var(--color-primary);
    background: var(--color-primary);
    color: #fff;
  }

  .cat-count {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 18px;
    height: 18px;
    background: var(--color-border);
    border-radius: 50%;
    font-size: 0.7rem;
    font-weight: 800;
    color: var(--color-text-muted);
    transition: background var(--transition), color var(--transition);
  }

  .cat-nav-link:hover .cat-count {
    background: rgba(255,255,255,0.25);
    color: #fff;
  }

  /* カテゴリセクション */
  .category-section {
    margin-bottom: 52px;
    scroll-margin-top: 80px;
  }

  .category-section-head {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
    padding-bottom: 12px;
    border-bottom: 3px solid var(--color-primary);
  }

  .category-section-title {
    font-size: 1.2rem;
    font-weight: 800;
    color: var(--color-text);
  }

  .article-count {
    font-size: 0.78rem;
    font-weight: 700;
    color: var(--color-text-muted);
    background: var(--color-bg);
    padding: 2px 8px;
    border-radius: 10px;
    border: 1px solid var(--color-border);
  }

  /* 記事リスト */
  .article-list { display: flex; flex-direction: column; gap: 12px; }

  .article-card {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
    background: var(--color-card);
    border-radius: var(--radius);
    padding: 20px 24px;
    box-shadow: var(--shadow);
    border-left: 4px solid transparent;
    transition: box-shadow var(--transition), transform var(--transition), border-color var(--transition);
    color: var(--color-text);
  }

  .article-card:hover {
    box-shadow: var(--shadow-hover);
    transform: translateY(-1px);
    border-left-color: var(--color-primary);
  }

  .article-body { flex: 1; min-width: 0; }

  .article-title {
    font-size: 0.98rem;
    font-weight: 800;
    margin-bottom: 6px;
    line-height: 1.4;
  }

  .article-desc {
    font-size: 0.83rem;
    color: var(--color-text-muted);
    line-height: 1.5;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .article-cta {
    flex-shrink: 0;
    white-space: nowrap;
    font-size: 0.83rem;
    font-weight: 700;
    color: var(--color-primary);
    padding: 8px 16px;
    border: 2px solid var(--color-primary);
    border-radius: var(--radius);
    transition: all var(--transition);
  }

  .article-card:hover .article-cta {
    background: var(--color-primary);
    color: #fff;
  }

  @media (max-width: 600px) {
    .article-card { flex-direction: column; align-items: flex-start; }
    .article-cta { align-self: flex-end; }
  }
</style>
