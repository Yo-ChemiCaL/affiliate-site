---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { url } from '../../lib/url';
import productsData from '../../data/products.json';

const pickFiles = await Astro.glob('../../data/picks/*.json');
const picks = pickFiles
  .map((f) => {
    const pick = f.default;
    const product = productsData.find((p) => p.slug === pick.productSlug);
    return { ...pick, product };
  })
  .filter((p) => p.product && !p.draft)
  .sort((a, b) => new Date(b.publishedAt).getTime() - new Date(a.publishedAt).getTime());
---

<BaseLayout
  title="デスクガジェット 即決ガイド一覧 | mono-lab"
  description="デスクセットアップに役立つ「これを買えばOK」な1製品を厳選した即決ガイドの一覧です。"
>
  <div class="container page-content">
    <h1 class="page-title">デスクガジェット 即決ガイド</h1>
    <p class="page-desc">「これを買えばOK」という1製品に絞ったデスク向けガイドです。選ぶ手間をゼロにします。</p>

    <div class="pick-grid">
      {picks.map((pick) => (
        <a href={url(`/pick/${pick.slug}/`)} class="pick-card">
          <div class="pick-image">
            <img src={pick.product.image} alt={pick.product.title} loading="lazy" width="300" height="200" />
          </div>
          <div class="pick-body">
            <p class="pick-target">{pick.targetUser}</p>
            <h2 class="pick-title">{pick.title}</h2>
            <p class="pick-product-name">{pick.product.title}</p>
            {pick.product.price && (
              <p class="pick-price">
                {pick.product.originalPrice && <s>¥{pick.product.originalPrice.toLocaleString()}</s>}
                <strong>¥{pick.product.price.toLocaleString()}</strong>
              </p>
            )}
            <span class="pick-cta">即決ガイドを見る →</span>
          </div>
        </a>
      ))}
    </div>
  </div>
</BaseLayout>

<style>
  .page-content { padding: 40px 0 64px; }
  .page-title { font-size: 1.8rem; font-weight: 900; margin-bottom: 8px; }
  .page-desc { color: var(--color-text-muted); margin-bottom: 32px; }

  .pick-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }

  .pick-card { background: var(--color-card); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; color: var(--color-text); transition: transform var(--transition), box-shadow var(--transition); }
  .pick-card:hover { transform: translateY(-2px); box-shadow: var(--shadow-hover); }

  .pick-image { aspect-ratio: 3/2; overflow: hidden; }
  .pick-image img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
  .pick-card:hover .pick-image img { transform: scale(1.04); }

  .pick-body { padding: 16px; }
  .pick-target { font-size: 0.72rem; color: var(--color-primary); font-weight: 700; margin-bottom: 6px; }
  .pick-title { font-size: 0.95rem; font-weight: 800; line-height: 1.4; margin-bottom: 8px; }
  .pick-product-name { font-size: 0.78rem; color: var(--color-text-muted); margin-bottom: 6px; }
  .pick-price { margin-bottom: 12px; }
  .pick-price s { font-size: 0.78rem; color: var(--color-text-muted); margin-right: 6px; }
  .pick-price strong { font-size: 1.1rem; color: #e63946; font-weight: 900; }
  .pick-cta { display: inline-block; font-size: 0.82rem; font-weight: 700; color: var(--color-primary); border-bottom: 1px solid currentColor; }
</style>
