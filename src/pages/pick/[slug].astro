---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { url } from '../../lib/url';
import productsData from '../../data/products.json';

export async function getStaticPaths() {
  const pickFiles = await Astro.glob('../../data/picks/*.json');
  return pickFiles.map((f) => ({
    params: { slug: f.default.slug },
    props: { pick: f.default },
  }));
}

const { pick } = Astro.props;
const product = productsData.find((p) => p.slug === pick.productSlug);
if (!product) throw new Error(`Product not found: ${pick.productSlug}`);

const stars = '‚òÖ'.repeat(Math.round(product.rating)) + '‚òÜ'.repeat(5 - Math.round(product.rating));
const discount = product.originalPrice && product.price
  ? Math.round((1 - product.price / product.originalPrice) * 100)
  : null;
---

<BaseLayout
  title={`${pick.title} | mono-lab`}
  description={`${pick.targetUser}Âêë„Åë„ÄÇ${pick.reasons[0]}`}
  ogImage={product.image}
  ogType="article"
>
  <div class="container pick-page">
    <!-- Breadcrumb -->
    <nav class="breadcrumb">
      <ol>
        <li><a href={url('/')}>„Éõ„Éº„É†</a></li>
        <li><a href={url('/pick/')}>Âç≥Ê±∫„Ç¨„Ç§„Éâ</a></li>
        <li aria-current="page">{pick.title}</li>
      </ol>
    </nav>

    <div class="pick-layout">
      <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
      <main class="pick-main">
        <span class="target-badge">ÂØæË±°: {pick.targetUser}</span>
        <h1 class="pick-title">{pick.title}</h1>

        <!-- ÁêÜÁî± -->
        <section class="reasons-section">
          <h2>„Åì„Çå„ÇíÈÅ∏„Å∂3„Å§„ÅÆÁêÜÁî±</h2>
          <ol class="reasons-list">
            {pick.reasons.map((r: string) => (
              <li class="reason-item">
                <span class="reason-icon">‚úÖ</span>
                <span>{r}</span>
              </li>
            ))}
          </ol>
        </section>

        <!-- Ê≥®ÊÑèÁÇπ -->
        <div class="caution-box">
          <p class="caution-label">‚ö†Ô∏è Ê≥®ÊÑèÁÇπ</p>
          <p>{pick.caution}</p>
        </div>

        <!-- ‰ª£ÊõøÂÄôË£ú -->
        <div class="alternatives">
          <p class="alt-label">„ÇÇ„Å£„Å®ÊØîËºÉ„Åó„Å¶„Åã„ÇâÊ±∫„ÇÅ„Åü„ÅÑÊñπ„ÅØ</p>
          <div class="alt-links">
            {pick.alternatives.map((slug: string) => (
              <a
                href={slug.startsWith('best-') ? url(`/best/${slug}/`) : url(`/pick/${slug}/`)}
                class="alt-link"
              >
                {slug.startsWith('best-') ? 'ÊØîËºÉË®ò‰∫ã„ÇíË¶ã„Çã ‚Üí' : 'Âà•„ÅÆÈÅ∏ÊäûËÇ¢„ÇíË¶ã„Çã ‚Üí'}
              </a>
            ))}
            <a href={url(`/category/${product.categorySlug}/`)} class="alt-link">
              {product.category}„ÅÆ‰∏ÄË¶ß„ÇíË¶ã„Çã ‚Üí
            </a>
          </div>
        </div>
      </main>

      <!-- „Çµ„Ç§„Éâ„Éê„ÉºÔºàË≥ºÂÖ•CTAÔºâ -->
      <aside class="pick-sidebar">
        <div class="cta-card sticky">
          <div class="cta-image">
            <img src={product.image} alt={product.title} width="300" height="200" loading="eager" />
            {discount && <span class="discount-badge">{discount}%OFF</span>}
          </div>
          <div class="cta-body">
            <p class="cta-product-name">{product.title}</p>
            <div class="cta-rating">
              <span class="stars">{stars}</span>
              <span class="rating-num">{product.rating}</span>
              <span class="review-count">({product.reviewCount.toLocaleString()}‰ª∂)</span>
            </div>
            <div class="cta-price">
              {product.originalPrice && <s class="orig-price">¬•{product.originalPrice.toLocaleString()}</s>}
              <span class="curr-price">¬•{product.price?.toLocaleString()}</span>
            </div>
            <a
              href={product.amazonUrl}
              class="btn-affiliate btn-amazon btn-cta"
              target="_blank"
              rel="noopener noreferrer nofollow"
            >
              üõí Amazon„Åß‰æ°Ê†º„ÇíË¶ã„Çã
            </a>
            <p class="cta-note">‚Äª „É™„É≥„ÇØ„ÅØ„Ç¢„Éï„Ç£„É™„Ç®„Ç§„Éà„É™„É≥„ÇØ„Åß„Åô</p>
          </div>
        </div>
      </aside>
    </div>

    <!-- „Éö„Éº„Ç∏‰∏ãÈÉ®CTAÔºà2ÁÆáÊâÄÁõÆÔºâ -->
    <div class="bottom-cta">
      <p class="bottom-cta-title">{pick.title}</p>
      <a
        href={product.amazonUrl}
        class="btn-affiliate btn-amazon btn-cta"
        target="_blank"
        rel="noopener noreferrer nofollow"
      >
        üõí Amazon„Åß‰æ°Ê†º„ÇíË¶ã„Çã
      </a>
      <a href={url('/best/')} class="btn-back">‰ªñ„ÅÆÊØîËºÉË®ò‰∫ã„ÇíË¶ã„Çã</a>
    </div>

    <p class="policy-footnote">
      Êé≤ËºâÂü∫Ê∫ñ„Å´„Å§„ÅÑ„Å¶Ôºö<a href={url('/methodology/')}>ÈÅ∏ÂÆöÂü∫Ê∫ñ</a> Ôºè <a href={url('/editorial-policy/')}>Á∑®ÈõÜÊñπÈáù</a>
    </p>
  </div>
</BaseLayout>

<style>
  .pick-page { padding: 24px 0 64px; }

  .breadcrumb ol { display: flex; list-style: none; gap: 8px; font-size: 0.8rem; color: var(--color-text-muted); flex-wrap: wrap; margin-bottom: 24px; }
  .breadcrumb li:not(:last-child)::after { content: '‚Ä∫'; margin-left: 8px; }
  .breadcrumb a { color: var(--color-primary); }

  .pick-layout { display: grid; grid-template-columns: 1fr 320px; gap: 40px; align-items: start; margin-bottom: 40px; }

  /* „É°„Ç§„É≥ */
  .pick-main {}
  .target-badge { display: inline-block; background: var(--color-primary); color: #fff; font-size: 0.75rem; font-weight: 700; padding: 4px 12px; border-radius: 4px; margin-bottom: 12px; }
  .pick-title { font-size: clamp(1.3rem, 3vw, 1.8rem); font-weight: 900; line-height: 1.3; margin-bottom: 32px; }

  .reasons-section h2 { font-size: 1.05rem; font-weight: 800; margin-bottom: 16px; }
  .reasons-list { list-style: none; display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; }
  .reason-item { display: flex; gap: 12px; align-items: flex-start; background: var(--color-card); padding: 14px 16px; border-radius: var(--radius); box-shadow: var(--shadow); font-size: 0.95rem; line-height: 1.6; }
  .reason-icon { flex-shrink: 0; font-size: 1.1rem; }

  .caution-box { background: #fffbf0; border-left: 4px solid #f59e0b; padding: 16px 20px; border-radius: 0 var(--radius) var(--radius) 0; margin-bottom: 24px; }
  .caution-label { font-weight: 700; font-size: 0.85rem; margin-bottom: 6px; color: #b45309; }

  .alternatives { padding: 16px 0; }
  .alt-label { font-size: 0.85rem; color: var(--color-text-muted); margin-bottom: 12px; }
  .alt-links { display: flex; flex-wrap: wrap; gap: 8px; }
  .alt-link { font-size: 0.82rem; font-weight: 600; color: var(--color-primary); padding: 6px 14px; border: 1px solid var(--color-primary); border-radius: 20px; transition: all var(--transition); }
  .alt-link:hover { background: var(--color-primary); color: #fff; }

  /* „Çµ„Ç§„Éâ„Éê„Éº */
  .cta-card { background: var(--color-card); border-radius: var(--radius); box-shadow: 0 4px 20px rgba(0,0,0,0.12); overflow: hidden; }
  .cta-card.sticky { position: sticky; top: 80px; }
  .cta-image { position: relative; aspect-ratio: 3/2; overflow: hidden; }
  .cta-image img { width: 100%; height: 100%; object-fit: cover; }
  .discount-badge { position: absolute; top: 8px; right: 8px; background: #e63946; color: #fff; font-size: 0.75rem; font-weight: 700; padding: 3px 8px; border-radius: 4px; }
  .cta-body { padding: 16px; }
  .cta-product-name { font-size: 0.88rem; font-weight: 700; margin-bottom: 8px; line-height: 1.4; }
  .cta-rating { display: flex; align-items: center; gap: 6px; margin-bottom: 10px; }
  .stars { color: var(--color-accent); font-size: 0.85rem; }
  .rating-num { font-weight: 700; font-size: 0.9rem; }
  .review-count { font-size: 0.75rem; color: var(--color-text-muted); }
  .cta-price { margin-bottom: 14px; }
  .orig-price { font-size: 0.85rem; color: var(--color-text-muted); display: block; }
  .curr-price { font-size: 1.6rem; font-weight: 900; color: #e63946; }
  .btn-cta { padding: 14px 20px; font-size: 0.95rem; width: 100%; }
  .cta-note { font-size: 0.68rem; color: var(--color-text-muted); margin-top: 8px; text-align: center; }

  /* ‰∏ãÈÉ®CTA */
  .bottom-cta { background: var(--color-card); border-radius: var(--radius); padding: 24px; box-shadow: var(--shadow); text-align: center; display: flex; flex-direction: column; align-items: center; gap: 12px; }
  .bottom-cta-title { font-size: 1rem; font-weight: 800; }
  .btn-cta { max-width: 360px; }
  .btn-back { font-size: 0.82rem; color: var(--color-text-muted); text-decoration: underline; }

  .policy-footnote { font-size: 0.78rem; color: var(--color-text-muted); margin-top: 24px; text-align: center; }
  .policy-footnote a { color: var(--color-primary); }

  @media (max-width: 768px) {
    .pick-layout { grid-template-columns: 1fr; }
    .cta-card.sticky { position: static; }
  }
</style>
